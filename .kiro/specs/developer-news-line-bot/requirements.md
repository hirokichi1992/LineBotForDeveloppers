# 要件定義書

## 1. プロジェクト概要
本プロジェクトは、開発者が最新の技術情報を効率的に収集するためのLINEボットです。設定されたRSSフィードから記事を自動収集し、AI（Gemini）を用いて要約やクイズを生成し、LINEを通じてユーザーに配信します。

## 2. 主要なユースケース
開発者として、LINEで最新技術ニュースのダイジェストを受け取りたい。これにより、空き時間で手軽にトレンドを把握できるようになる。

## 3. 機能要件

### 3.1. 記事の取得と処理
- **R-01**: 設定ファイル（`config/feeds.php`）に定義された複数のRSSフィードから記事を自動的に取得すること。
- **R-02**: 各記事について、Gemini APIを使用して、約200字の要約、最大3つの関連タグ、および三択クイズを生成すること。
- **R-03**: 処理された記事データ（タイトル、URL、要約、タグ、クイズなど）をPostgreSQLデータベースに保存すること。
- **R-04**: URLに基づいて重複した記事が保存されるのを防ぐこと。
- **R-05**: この処理は、日次のスケジュールタスク（`run_daily.php`）として実行されること。

### 3.2. LINEボットの対話
- **R-06**: LINEプラットフォームからのWebhookイベントを受信し、処理すること。
- **R-07**: ユーザーが特定のメッセージ（例：「最新情報」や「news」）を送信した際に、最新の未読記事を返信すること。
- **R-08**: 記事はLINE Flex Messageのカルーセル形式で表示し、各記事を個別のバブルに格納すること。
- **R-09**: ユーザーに記事が配信された後、再度「新着」として送信されるのを防ぐために、記事をアーカイブ済みとしてマークすること。

### 3.3. コンテンツ検索
- **R-10**: ユーザーは、キーワード付きのコマンド（例：「最新情報 AI」）を送信することで記事を検索できること。
- **R-11**: タイトル、要約、またはタグがキーワードに一致する記事をデータベースで検索すること。
- **R-12**: 検索結果は、同じFlex Messageカルーセル形式でユーザーに返信すること。

### 3.4. クイズ機能
- **R-13**: AIによって生成されたクイズは、記事のFlex Messageバブル内に表示されること。
- **R-14**: ユーザーがクイズに回答した（ボタンをタップした）際に、ポストバックイベントを処理すること。
- **R-15**: 回答が正解か不正解かを示すメッセージをユーザーに返信すること。

### 3.5. 週間サマリー
- **R-16**: 過去7日間の全記事について、Gemini APIを使用して週間サマリーを生成すること。
- **R-17**: このサマリーは、単一のFlex Messageとして、事前に設定された特定のユーザーIDに送信されること。
- **R-18**: この処理は、週次のスケジュールタスク（`run_weekly.php`）として実行されること。

## 4. 非機能要件

### 4.1. 技術スタック
- **NF-01**: バックエンド: PHP
- **NF-02**: データベース: PostgreSQL
- **NF-03**: 主要API: LINE Messaging API, Google Gemini API
- **NF-04**: ウェブスクレイピング: Browserless.ioのようなサービスを利用して記事の全文を取得する場合がある。

### 4.2. 設定
- **NF-05**: APIキーやデータベース認証情報などの機密情報は、`.env`ファイルを介して管理すること。
- **NF-06**: 監視対象のRSSフィードリストは、`config/feeds.php`で設定可能であること。

### 4.3. データ永続化
- **NF-07**: すべての記事関連データは、定義されたスキーマ（`schema.sql`）を持つPostgreSQLデータベースに保存すること。

### 4.4. 実行環境
- **NF-08**: システムはDocker（`Dockerfile`）を介してデプロイ可能であること。
- **NF-09**: Webhookエンドポイント（`public/webhook.php`）は、LINEプラットフォームからのイベントを受信するために公開されている必要がある。
